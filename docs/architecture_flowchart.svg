<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1000" viewBox="0 0 1600 1000">
  <style>
    .box { fill: #f6f8fa; stroke: #8899aa; stroke-width: 2; }
    .title { font: 700 20px/1.2 -apple-system,BlinkMacSystemFont,'Segoe UI',Arial; }
    .label { font: 14px -apple-system,BlinkMacSystemFont,'Segoe UI',Arial; }
    .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
    .dashed { stroke-dasharray: 6 4; }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- Client -->
  <rect class="box" x="40" y="120" width="220" height="120" rx="8"/>
  <text class="title" x="50" y="150">前端/调用方</text>
  <text class="label" x="50" y="180">Web/慢病管理前端</text>

  <!-- API -->
  <rect class="box" x="300" y="80" width="280" height="200" rx="8"/>
  <text class="title" x="310" y="110">API (FastAPI)</text>
  <text class="label" x="310" y="140">POST /medical/qa | /medical/chat</text>
  <text class="label" x="310" y="160">POST /medical/index/build</text>
  <text class="label" x="310" y="180">POST /knowledge-graph/*</text>
  <text class="label" x="310" y="200">POST /medical/associations/search</text>

  <!-- Orchestrator -->
  <rect class="box" x="620" y="60" width="300" height="240" rx="8"/>
  <text class="title" x="630" y="90">编排与增强</text>
  <text class="label" x="630" y="120">enhanced_rag_service</text>
  <text class="label" x="630" y="140">意图识别 (smart/qwen/keyword)</text>
  <text class="label" x="630" y="160">质量评估 / 安全审核</text>
  <text class="label" x="630" y="180">medical_answer_stream</text>

  <!-- Retrieval -->
  <rect class="box" x="960" y="100" width="240" height="160" rx="8"/>
  <text class="title" x="970" y="130">检索服务</text>
  <text class="label" x="970" y="160">enhanced_index_service</text>

  <!-- Knowledge -->
  <rect class="box" x="960" y="280" width="240" height="160" rx="8"/>
  <text class="title" x="970" y="310">知识增强</text>
  <text class="label" x="970" y="340">知识图谱 (kg_service)</text>
  <text class="label" x="970" y="360">医疗关联 (association)</text>

  <!-- Gen -->
  <rect class="box" x="620" y="330" width="300" height="120" rx="8"/>
  <text class="title" x="630" y="360">生成模型</text>
  <text class="label" x="630" y="390">LLM (Qwen/等)</text>

  <!-- Data -->
  <rect class="box" x="1240" y="80" width="300" height="360" rx="8"/>
  <text class="title" x="1250" y="110">数据层</text>
  <text class="label" x="1250" y="140">FAISS 向量库(分库)</text>
  <text class="label" x="1250" y="160">Markdown 原文档</text>
  <text class="label" x="1250" y="180">知识图谱存储</text>
  <text class="label" x="1250" y="200">state_store / 缓存</text>

  <!-- arrows main path -->
  <line class="arrow" x1="260" y1="180" x2="300" y2="180"/>
  <line class="arrow" x1="580" y1="180" x2="620" y2="180"/>
  <line class="arrow" x1="920" y1="180" x2="960" y2="180"/>
  <line class="arrow" x1="770" y1="270" x2="770" y2="330"/>
  <line class="arrow" x1="920" y1="380" x2="1240" y2="380"/>

  <!-- arrows to knowledge & data -->
  <line class="arrow" x1="920" y1="210" x2="960" y2="310"/>
  <line class="arrow" x1="920" y1="360" x2="960" y2="360"/>
  <line class="arrow" x1="1240" y1="160" x2="1200" y2="160"/>
  <line class="arrow" x1="1240" y1="320" x2="1200" y2="340"/>

  <!-- captions -->
  <text class="label" x="320" y="260">索引构建/维护 → 数据层</text>
  <text class="label" x="640" y="210">RAG编排 → 检索/增强/生成</text>
</svg>