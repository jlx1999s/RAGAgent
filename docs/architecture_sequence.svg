<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1000" viewBox="0 0 1600 1000">
  <style>
    .lifeline { stroke: #999; stroke-width: 2; }
    .box { fill: #f6f8fa; stroke: #8899aa; stroke-width: 2; }
    .title { font: 700 18px/1.2 -apple-system,BlinkMacSystemFont,'Segoe UI',Arial; }
    .label { font: 14px -apple-system,BlinkMacSystemFont,'Segoe UI',Arial; }
    .arrow { stroke: #333; stroke-width: 2; marker-end: url(#arrowhead); }
    .dashed { stroke: #333; stroke-width: 2; stroke-dasharray: 6 4; marker-end: url(#arrowhead); }
  </style>
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="10" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#333" />
    </marker>
  </defs>

  <!-- participants -->
  <!-- positions: 80, 220, 360, 500, 640, 780, 920, 1060, 1200, 1340 -->
  <rect class="box" x="40" y="20" width="80" height="40" rx="6"/><text class="title" x="50" y="48">Client</text><line class="lifeline" x1="80" y1="70" x2="80" y2="930"/>
  <rect class="box" x="180" y="20" width="100" height="40" rx="6"/><text class="title" x="190" y="48">FastAPI</text><line class="lifeline" x1="230" y1="70" x2="230" y2="930"/>
  <rect class="box" x="320" y="20" width="140" height="40" rx="6"/><text class="title" x="330" y="48">RAG Service</text><line class="lifeline" x1="390" y1="70" x2="390" y2="930"/>
  <rect class="box" x="460" y="20" width="120" height="40" rx="6"/><text class="title" x="470" y="48">Intent</text><line class="lifeline" x1="520" y1="70" x2="520" y2="930"/>
  <rect class="box" x="600" y="20" width="120" height="40" rx="6"/><text class="title" x="610" y="48">Quality</text><line class="lifeline" x1="660" y1="70" x2="660" y2="930"/>
  <rect class="box" x="740" y="20" width="120" height="40" rx="6"/><text class="title" x="750" y="48">KG</text><line class="lifeline" x1="800" y1="70" x2="800" y2="930"/>
  <rect class="box" x="880" y="20" width="120" height="40" rx="6"/><text class="title" x="890" y="48">Assoc</text><line class="lifeline" x1="940" y1="70" x2="940" y2="930"/>
  <rect class="box" x="1020" y="20" width="140" height="40" rx="6"/><text class="title" x="1030" y="48">Index</text><line class="lifeline" x1="1090" y1="70" x2="1090" y2="930"/>
  <rect class="box" x="1160" y="20" width="140" height="40" rx="6"/><text class="title" x="1170" y="48">Vector</text><line class="lifeline" x1="1230" y1="70" x2="1230" y2="930"/>
  <rect class="box" x="1300" y="20" width="140" height="40" rx="6"/><text class="title" x="1310" y="48">LLM/Stream</text><line class="lifeline" x1="1370" y1="70" x2="1370" y2="930"/>

  <!-- messages -->
  <text class="label" x="95" y="130">POST /api/v1/medical/qa</text>
  <line class="arrow" x1="80" y1="140" x2="230" y2="140"/>

  <text class="label" x="245" y="170">medical_retrieve(question, filters)</text>
  <line class="arrow" x1="230" y1="180" x2="390" y2="180"/>

  <text class="label" x="405" y="210">recognize_*_medical_intent</text>
  <line class="arrow" x1="390" y1="220" x2="520" y2="220"/>

  <text class="label" x="405" y="250">assess(query)</text>
  <line class="arrow" x1="390" y1="260" x2="660" y2="260"/>

  <text class="label" x="405" y="290">enhance_query_with_kg</text>
  <line class="arrow" x1="390" y1="300" x2="800" y2="300"/>

  <text class="label" x="405" y="330">find_associations</text>
  <line class="arrow" x1="390" y1="340" x2="940" y2="340"/>

  <text class="label" x="405" y="370">search_medical_documents</text>
  <line class="arrow" x1="390" y1="380" x2="1090" y2="380"/>

  <text class="label" x="1105" y="410">query vector stores</text>
  <line class="arrow" x1="1090" y1="420" x2="1230" y2="420"/>

  <text class="label" x="1045" y="450">citations/context/metadata</text>
  <line class="dashed" x1="1090" y1="460" x2="390" y2="460"/>

  <text class="label" x="245" y="490">medical_answer_stream(...)</text>
  <line class="arrow" x1="230" y1="500" x2="1370" y2="500"/>

  <text class="label" x="1315" y="530">安全审核</text>
  <line class="arrow" x1="1370" y1="540" x2="660" y2="540"/>

  <text class="label" x="1245" y="570">聚合事件为最终JSON</text>
  <line class="dashed" x1="1370" y1="580" x2="230" y2="580"/>

  <text class="label" x="245" y="610">{answer, citations, metadata, ...}</text>
  <line class="arrow" x1="230" y1="620" x2="80" y2="620"/>
</svg>